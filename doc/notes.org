* Naming convention
- Cluster :: One or more Instruments connected with one Controller via one or
             more serial interfaces (RS-232, RS-485, USB, Zigbee connected to
             USB or RS-232).
- Family :: Each Instrument belongs to one of the three Families: Doseman, DACM
            and RadonScout.
- Instrument :: A SARAD product with serial interface and at least one Sensor
                and maybe one or more Actors. Every Instrument is characterized
                by FamilyId, TypeId, SoftwareVersion and SerialNumber. As soon
                as a Cluster is established, the Instrument will get a unique
                Id.
- Component :: Modular sensor or actor device built into an Instrument. A
               Component can deliver one or more measuring values.
- Sensor :: Part of a sensor Component delivering at least one Measurand
            (Messgröße) belonging to exactly one physical variable. Multiple
            Measurands belonging to the same physical variable are typically:
            recent sampling, average, minimum, maximum, error in percent.
- Measurand :: Value, Operator and Unit delivered by a Sensor
- Operator :: Mathematical operator characterizing a Value of a Measurand.
              Typical Operators in the context of SARAD Instruments are <, >,
              and ±.
- Value :: A number delivered by a Sensor as part of the Measurand
- Unit :: The physical unit of a Measurand as gained from the Instrument
          description retrieved from a database or from the Instrument itself.
- Actor :: Part of an actor Component receiving a Parameter and doing something
           with the Instrument.
* Instrument characterization
** Family
- id
- name (e.g. 'DACM family')
- baudrate
- parity (e.g. serial.PARITY_NONE)
- write_sleeptime (time to wait between writing consecutive bytes)
- wait_for_reply (time to wait after writing a command)
- get_id_cmd (list of command and data bytes for the get_id command e.g. [b'\x0c', b'\xff\x00\x00'])
- length_of_reply (expected length of the reply to the get_id command)
- types (list of instrument types belonging into this family)

** Instrument in the cluster
Every instrument in the cluster is completely defined by the following objects:
- is_connected :: Boolean indicating whether the object is connected to the cluster
- port :: The serial port, the device is connected to.
- family :: The dictionary describing the features of the instrument family.
- id :: An Id that is given to identify the instrument within the cluster.
- type_id :: The Id of an instrument type within an instrument family.
- type_name :: Name of the instrument type.
- software_version :: Version of the firmware running on the instrument.
- serial_number :: Serial number of the instrument.
- components :: A list of instrument components (e.g. NO_x sensor, pump)
  - id :: Component Id
  - name :: Component name
  - measurands :: A list of measurands delivered by the component ("Result Index" in DACM naming)
    - id :: Measurand Id
    - name :: Measurand name
    - items :: A list of items belonging to a measurand (e.g. recent sampling, average of the last completed interval,
      minimum, error)
      - id :: Item Id
      - name :: Item name
      - operator :: Mathematical operator that may belong to the item (e.g. '<', '>')
      - value :: Numerical value of the item
      - unit :: Measurement unit of the item

* How to differentiate between SARAD Instruments
** Basic assumptions
The baud rate is fixed per instrument type and either 9600 or 115200 baud.
** Radon Scout family
- baud rate :: 9600
- parity :: none 
- byte order :: big endian
- GetId command :: \x0c
- C_OK :: \x0a
*** Without display
- no recent values
**** Radon Scout 1
- no get_battery_voltage command
**** Radon Scout 2
- get_battery_voltage command with 1-byte-reply
*** With display
- recent values
**** Thoron Scout
- get_battery_voltage command with 2-byte-reply
** DOSEman family
- baud rate :: 115200 baud
- parity :: even 
- byte order :: little endian
- GetId command :: \x40
- C_OK :: \x00 
** DACM family
- baud rate :: 9600
- parity :: none 
- byte order :: big endian
- GetId command :: \x0c, reply > 19 byte
- C_OK :: \x0a

* Instrument database
The instrument database is a YAML file containing information about
communication parameters and sensor and actor configuration of SARAD instruments
of various types as well as of the configuration of individual instruments.
Instruments, Components, Sensors and Measurands are described in a hierarchical
tree.
* Buffer settings                                           :ARCHIVE:noexport:
** Publishing
#+BEGIN_SRC emacs-lisp
(require 'ox-publish)
(setq public-html "~/mstrey/public_html/")
(defun rename-sarad (project-plist)
  "Rename sarad.html into index.html"
  (let ((htmlfile (concat public-html "todo/sarad.html")))
    (if (file-exists-p htmlfile)
        (rename-file htmlfile
                     (concat public-html "todo/index.html") t))))
(setq org-publish-project-alist
      `(("org-notes"
         :base-directory "~/mstrey/Work/GTD_Sarad/"
         :base-extension "org"
         :publishing-directory ,(concat public-html "todo/")
         :recursive t
         :publishing-function org-html-publish-to-html
         :section-numbers nil
         :with-archived-trees t
         :with-latex t
         :with-smart-quotes t
         :with-sub-superscript nil
         :with-timestamps t
         :html-doctype "html5"
         :html-html5-fancy t
         :html-head-include-default-style nil
         :html-preamble t
         :html-validation-link nil
         :completion-function rename-sarad)
        ("org-static"
         :base-directory "~/mstrey/Work/GTD_Sarad/"
         :base-extension "css\\|js\\|png\\|jpg\\|gif\\|pdf\\|mp3\\|ogg\\|swf\\|org\\|odt"
         :exclude "sarad.org"
         :publishing-directory ,(concat public-html "todo/")
         :recursive t
         :publishing-function org-publish-attachment)
        ("org" :components ("org-notes" "org-static"))))
#+END_SRC

#+RESULTS:
| org-notes  | :base-directory | ~/mstrey/Work/GTD_Sarad/ | :base-extension | org  | :publishing-directory | ~/mstrey/public_html/todo/ | :recursive | t    | :publishing-function | org-html-publish-to-html | :section-numbers | nil  | :with-archived-trees | t   | :with-latex | t         | :with-smart-quotes    | t                          | :with-sub-superscript | nil | :with-timestamps     | t                      | :html-doctype | html5 | :html-html5-fancy | t | :html-head-include-default-style | nil | :html-preamble | t | :html-validation-link | nil | :completion-function | rename-sarad |
| org-static | :base-directory | ~/mstrey/Work/GTD_Sarad/ | :base-extension | css\ | js\                   | png\                       | jpg\       | gif\ | pdf\                 | mp3\                     | ogg\             | swf\ | org\                 | odt | :exclude    | sarad.org | :publishing-directory | ~/mstrey/public_html/todo/ | :recursive            | t   | :publishing-function | org-publish-attachment |               |       |                   |   |                                  |     |                |   |                       |     |                      |              |
| org        | :components     | (org-notes org-static)   |                 |      |                       |                            |            |      |                      |                          |                  |      |                      |     |             |           |                       |                            |                       |     |                      |                        |               |       |                   |   |                                  |     |                |   |                       |     |                      |              |

** Setup
:PROPERTIES:
:END:
#+STARTUP: overview
#+STARTUP: hidestars
#+STARTUP: logdone
#+STARTUP: indent
#+DRAWERS: PROPERTIES LOGBOOK
#+PROPERTY: Effort_ALL 0 0:10 0:20 0:30 1:00 2:00 3:00 4:00 8:00
#+TAGS: W(w) PROJECT(p) PC(a) I(i) V(v) E(e) C(c)
#+TAGS: noexport(n) export(x)
#+SEQ_TODO: TODO(t!) NEXT(n!) WAITING(w@/!) | DONE(d!) CANCELLED(c@)
#+TITLE: Datensammler
#+AUTHOR:    Michael Strey
#+EMAIL:     strey@sarad.de
#+LANGUAGE: en
#+LATEX_CLASS: article
#+LATEX_HEADER: \usepackage{xcolor}
#+LATEX_HEADER: \def\todo#1{{\color{red}#1}}
#+LATEX_HEADER: \def\next#1{{\color{red}#1}}
#+LATEX_HEADER: \def\done#1{{\color{green}#1}}
#+LATEX_HEADER: \def\cancelled#1{{\color{green}#1}}
#+LATEX_HEADER: \def\deferred#1{{\color{yellow}#1}}
#+LATEX_HEADER: \def\waiting#1{{\color{blue}#1}}
#+LATEX_HEADER: \def\pending#1{{\color{orange}#1}}
#+LATEX_HEADER: \def\won#1{{\color{green}#1}}
#+LATEX_HEADER: \def\lost#1{{\color{blue}#1}}
#+EXPORT_SELECT_TAGS: export
#+EXPORT_EXCLUDE_TAGS: noexport
#+OPTIONS: toc:2 H:5 email:t tags:t |:t todo:t d:nil
#+SETUPFILE: /home/SARAD/mstrey/mstrey/Work/Vorlagen/org-html-themes/setup/theme-bigblow-local.setup
